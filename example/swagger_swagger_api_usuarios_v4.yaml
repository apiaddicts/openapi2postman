swagger: "2.0"
info:
  version: v1
  title: mediators_usuarios
  description: "----\n### Descripción del API\nApi para la gestión de usuarios de la Comunidad de Madrid\nUn usuario que acceda a recursos de la Comunidad de Madrid pueden estar en varios almacenes de usuarios\nUna aplicación sólo puede estar en un unico repositorio de usuarios\n\n### Almacenes de usuarios\n  * USUG_DA\n  * USUS_LDAP\n  * USUI\n  * USUT\n\n### Funcionalidades básicas del API\n  * Consultar datos de usuarios, estado, perfiles y aplicaciones de un usuario\n  * Consultar los usuarios de una aplicación\n  * Obtener un token de usuario\n  * Solicitar el cambio de password, a partir de un usuario y password antiguos\n  * Registrar el acceso de un usuario a una aplicación\n  * Bloquear un usuario en los almacenes de usuarios de la CM\n  \n  \n### Documentación adicional\n[Manual de gestión de usuarios](http://intranet.madrid.org/arquitecturasw/)\n  \n\n### Códigos de error de todo el API (se especifican en cada recurso):\n1001 - TipoId o Id de usuario inexistente\n1002 - Credenciales erronéas\n1003 - Nueva password no cumple los requisitos (detalle en la descripción)      \n1004 - Almacen de usuarios incorrecto\n----\n"
  contact:
    name: Unidad de Arquitectura Software
    url: "http://wwww.madrid.org/soportesw"
    email: "md_arquitecturasw@madrid.org"
host: apis.comunidad.madrid
basePath: /mediators/usuarios
schemes:
  - https
consumes:
  - application/json
produces:
  - application/json
paths:
  /usuarios/estado/get:
    post:
      summary: Consultar el estado de un usuario (POST)
      description: "Permite obtener el **estado** de un usuario mediante su identificador único que es el login.\nDicho identificador es un parámetro obligatorio en la URL.\n### Códigos de error del método:\n* 1001 - login incorrecto\n"
      tags:
        - consultas
      parameters:
        - in: body
          name: request_body
          schema:
            $ref: "#/definitions/identificacion_usuario"
          required: true
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/usuarios_login_estado_response"
          examples:
            application/json:
              result:
                status: true
                http_code: 200
                request_id: 12345abcde
              data:
                correcto: true
                baja: false
                fecha_acceso_valida: true
                password_caducada: false
                tiene_preg_seguridad: true
                bloqueado: false
        "400":
          description: Bad request
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 400
                info: Parámetros incorrectos.
                request_id: 123456abcde
                errors:
                  - code: 1001
                    message: Mensaje de error en parámetro 1
                  - code: 1002
                    message: Mensaje de error en parámetro n
        "401":
          description: Unauthorized
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 401
                info: No autorizado
                request_id: 123456abcde
                errors:
                  - code: 1003
                    message: Usuario no autorizado o credenciales inválidas
        "403":
          description: Forbidden
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 403
                info: Recurso prohibido
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: El usuario no tiene permisos para realizar la acción solicitada
        "404":
          description: Not Found
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 404
                info: Usuario no encontrado
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: El usuario no existe en el almacén especificado
        "429":
          description: Too many requests
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 429
                info: Cuota de peticiones excedida
                request_id: 123456abcde
                errors:
                  - code: 1009
                    message: Se ha superado el número máximo de peticiones.
        default:
          description: Default error response
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 500
                info: Error desconocido
                request_id: 123456abcde
                errors:
                  - code: 0
                    message: Mensaje de error
      x-auth-type: Application User
      x-throttling-tier: Unlimited
      x-scope: USUG-api_user-scope
  /usuarios/get:
    post:
      summary: Consultar la información básica de un usuario
      description: "Permite obtener los datos de un usuario\n### Códigos de error del método:\n* 1001 - login incorrecto\n"
      tags:
        - consultas
      parameters:
        - in: body
          name: request_body
          schema:
            $ref: "#/definitions/identificacion_usuario"
          required: true
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/usuario"
          examples:
            application/json:
              result:
                status: true
                http_code: 200
                request_id: 12345abcde
              data:
                login_usuario: JRP123
                dni: 000000000T
                email: "jose.espanol@gmail.com"
                nombre: José
                apellido1: Español
                apellido2: Perez
                direccion: Embajadores 181
                telefono: 915805000
                organismo: Madrid Digital
                dependencia: Arquitecturas
                puesto_de_trabajo: 1P151
        "400":
          description: Bad request
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 400
                info: Parámetros incorrectos.
                request_id: 123456abcde
                errors:
                  - code: 1001
                    message: Mensaje de error en parámetro 1
                  - code: 1002
                    message: Mensaje de error en parámetro n
        "401":
          description: Unauthorized
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 401
                info: No autorizado
                request_id: 123456abcde
                errors:
                  - code: 1003
                    message: Usuario no autorizado o credenciales inválidas
        "403":
          description: Forbidden
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 403
                info: Recurso prohibido
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: El usuario no tiene permisos para realizar la acción solicitada
        "404":
          description: Not Found
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 404
                info: Usuario no encontrado
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: El usuario no existe en el almacén especificado
        "429":
          description: Too many requests
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 429
                info: Cuota de peticiones excedida
                request_id: 123456abcde
                errors:
                  - code: 1009
                    message: Se ha superado el número máximo de peticiones.
        default:
          description: Default error response
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 500
                info: Error desconocido
                request_id: 123456abcde
                errors:
                  - code: 0
                    message: Mensaje de error
      x-auth-type: Application User
      x-throttling-tier: Unlimited
      x-scope: USUG-api_user-scope
  /usuarios/perfiles/get:
    post:
      summary: Consultar los perfilesde un usuario en una aplicación
      description: "Permite obtener los datos de un usuario\n### Códigos de error del método:\n* 1001 - login incorrecto\n"
      tags:
        - consultas
      parameters:
        - in: body
          name: request_body
          schema:
            $ref: "#/definitions/identificacion_usuario_aplicacion"
          required: true
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/perfiles_response"
          examples:
            application/json:
              result:
                status: true
                http_code: 200
                request_id: 12345abcde
              data:
                perfiles:
                  - aplicacion: reee_presenta
                    id_perfil: 1
                    descripcion: consulta de datos
                  - aplicacion: qsrv_web
                    id_perfil: 5
                    descripcion: administrador
        "400":
          description: Bad request
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 400
                info: Parámetros incorrectos.
                request_id: 123456abcde
                errors:
                  - code: 1001
                    message: Mensaje de error en parámetro 1
                  - code: 1002
                    message: Mensaje de error en parámetro n
        "401":
          description: Unauthorized
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 401
                info: No autorizado
                request_id: 123456abcde
                errors:
                  - code: 1003
                    message: Usuario no autorizado o credenciales inválidas
        "403":
          description: Forbidden
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 403
                info: Recurso prohibido
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: El usuario no tiene permisos para realizar la acción solicitada
        "404":
          description: Not Found
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 404
                info: No encontrado
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: "El usuario no existe en el almacén especificado, no tiene perfil en la aplicación o esta no existe"
        "429":
          description: Too many requests
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 429
                info: Cuota de peticiones excedida
                request_id: 123456abcde
                errors:
                  - code: 1009
                    message: Se ha superado el número máximo de peticiones.
        default:
          description: Default error response
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 500
                info: Error desconocido
                request_id: 123456abcde
                errors:
                  - code: 0
                    message: Mensaje de error
      x-auth-type: Application User
      x-throttling-tier: Unlimited
      x-scope: USUG-api_user-scope
  /usuarios/aplicaciones/get:
    post:
      summary: Consultar las aplicaciones de un usuario
      description: Obtención las aplicaciones de un usuario
      tags:
        - consultas
      parameters:
        - in: body
          name: request_body
          schema:
            $ref: "#/definitions/usuarios_aplicaciones_body_parameters"
          required: true
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/usuarios_aplicaciones_response"
          examples:
            application/json:
              result:
                status: true
                http_code: 200
                request_id: 12345abcde
              data:
                aplicaciones:
                  - codigo_aplicacion: reee_presenta
                    descripcion: registro edificios eficiencia energetica
                    almacen_usuarios: USUG_DA
                    perfiles:
                      - aplicacion: reee_presenta
                        id_perfil: 1
                        descripcion: consulta
                      - aplicacion: reee_presenta
                        id_perfil: 2
                        descripcion: gestor
                  - codigo_aplicacion: xmen_app
                    descripcion: xmen_app
                    almacen_usuarios: USUG_LDAP
                    perfiles:
                      - aplicacion: xmen_app
                        id_perfil: 1
                        descripcion: consulta
        "400":
          description: Bad request
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 400
                info: Parámetros incorrectos.
                request_id: 123456abcde
                errors:
                  - code: 1001
                    message: Mensaje de error en parámetro 1
                  - code: 1002
                    message: Mensaje de error en parámetro n
        "401":
          description: Unauthorized
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 401
                info: No autorizado
                request_id: 123456abcde
                errors:
                  - code: 1003
                    message: Usuario no autorizado o credenciales inválidas
        "403":
          description: Forbidden
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 403
                info: Recurso prohibido
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: El usuario no tiene permisos para realizar la acción solicitada
        "404":
          description: Not Found
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 404
                info: No encontrado
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: "El usuario no existe en el almacén especificado, no tiene aplicaciones asociadas"
        "429":
          description: Too many requests
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 429
                info: Cuota de peticiones excedida
                request_id: 123456abcde
                errors:
                  - code: 1009
                    message: Se ha superado el número máximo de peticiones.
        default:
          description: Default error response
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 500
                info: Error desconocido
                request_id: 123456abcde
                errors:
                  - code: 0
                    message: Mensaje de error
      x-auth-type: Application User
      x-throttling-tier: Unlimited
      x-scope: USUG-api_user-scope
  "/aplicaciones/{codigo_aplicacion}/usuarios":
    get:
      summary: Consultar los usuarios de una aplicación (paginada y con select)
      description: Obtención los usuarios de una aplicación
      tags:
        - consultas
      parameters:
        - in: path
          name: codigo_aplicacion
          type: string
          description: Código de la aplicación
          required: true
        - in: query
          name: $init
          type: integer
          description: registro inicial
          default: 0
        - in: query
          name: $limit
          type: integer
          description: numero de registros a devolver. Por defecto 25. Maximo 1.000
          default: 25
          maximum: 1000
        - in: query
          name: $select
          type: string
          description: "campos que se van a seleccionar en la consulta por ejemplo $select=[login]"
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/aplicaciones_usuarios_response"
          examples:
            application/json:
              result:
                status: true
                http_code: 200
                request_id: 12345abcde
              metadata:
                start: 0
                end: 25
              data:
                usuarios:
                  - login_usuario: jose_espanol
                    dni: 000000000T
                    email: "jose.espanol@gmail.com"
                    nombre: José
                    apellido1: Español
                    apellido2: Perez
                    direccion: Embajadores 181
                    telefono: 915805000
                    organismo: Madrid Digital
                    dependencia: Arquitecturas
                    puesto_de_trabajo: 1P151
                    pefiles:
                      - aplicacion: reee_presenta
                        id_perfil: 1
                        description: perfil de consulta
        "400":
          description: Bad request
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 400
                info: Parámetros incorrectos.
                request_id: 123456abcde
                errors:
                  - code: 1001
                    message: Mensaje de error en parámetro 1
                  - code: 1002
                    message: Mensaje de error en parámetro n
        "401":
          description: Unauthorized
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 401
                info: No autorizado
                request_id: 123456abcde
                errors:
                  - code: 1003
                    message: Usuario no autorizado o credenciales inválidas
        "403":
          description: Forbidden
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 403
                info: Recurso prohibido
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: El usuario no tiene permisos para realizar la acción solicitada
        "404":
          description: Not Found
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 404
                info: No encontrado
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: La aplicación no existe o no tiene usuarios
        "429":
          description: Too many requests
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 429
                info: Cuota de peticiones excedida
                request_id: 123456abcde
                errors:
                  - code: 1009
                    message: Se ha superado el número máximo de peticiones.
        default:
          description: Default error response
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 500
                info: Error desconocido
                request_id: 123456abcde
                errors:
                  - code: 0
                    message: Mensaje de error
      x-auth-type: Application User
      x-throttling-tier: Unlimited
      x-scope: USUG-api_user-scope
  /token:
    post:
      summary: Obtención de un token de autenticacion de usuario
      description: "Genera un token de autenticacion a partir de un sistema de autenticación, usuario y una contraseña para una aplicación concreta\n### Códigos de error del método:\n* 1001 - login incorrecto\n* 1002 - credenciales incorrectas\n"
      tags:
        - modificación
      parameters:
        - in: body
          name: request_body
          schema:
            $ref: "#/definitions/token_body_parameters"
          required: true
      responses:
        "201":
          description: Created
          schema:
            $ref: "#/definitions/token_response"
          examples:
            Acceso correcto:
              result:
                status: true
                http_code: 201
                request_id: 12345abcde
              data:
                token: 0b71ce04-2439-49e8-8de0-2cda7937507d
        "400":
          description: Bad request
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 400
                info: Parámetros incorrectos.
                request_id: 123456abcde
                errors:
                  - code: 1001
                    message: Mensaje de error en parámetro 1
                  - code: 1002
                    message: Mensaje de error en parámetro n
        "401":
          description: Unauthorized
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 401
                info: No autorizado
                request_id: 123456abcde
                errors:
                  - code: 1003
                    message: Usuario no autorizado o credenciales inválidas
        "403":
          description: Forbidden
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 403
                info: Recurso prohibido
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: El usuario no tiene permisos para realizar la acción solicitada
        "429":
          description: Too many requests
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 429
                info: Cuota de peticiones excedida
                request_id: 123456abcde
                errors:
                  - code: 1009
                    message: Se ha superado el número máximo de peticiones.
        default:
          description: Default error response
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 500
                info: Error desconocido
                request_id: 123456abcde
                errors:
                  - code: 0
                    message: Mensaje de error
      x-auth-type: Application User
      x-throttling-tier: Unlimited
      x-scope: USUG-api_user-scope
  /usuarios/solicitudes/password:
    post:
      summary: Solicitud de cambio de password de un usuario
      description: "Permite modificar la contraseña mediante su identificador único. \nDicho identificador es un parámetro obligatorio en la URL. \nLos datos del recurso a modificar se incluirán en el *body* de la petición.\nLa llamada crea una solicitud de cambio de contraseña, \npor lo que devuelve un código http 201.\n### Códigos de error del método:\n* 1001 - login incorrecto\n* 1002 - Credenciales erronéas\n* 1003 - Nueva password no cumple los requisitos\n"
      tags:
        - modificación
      parameters:
        - in: body
          name: request_body
          schema:
            $ref: "#/definitions/password_body_parameters"
          required: true
      responses:
        "201":
          description: Created
          schema:
            $ref: "#/definitions/password_response"
          examples:
            solicitud de cambio de password correcta:
              result:
                status: true
                http_code: 201
                request_id: 12345abcde
                num_elements: 1
              data:
                id_solicitud: 263756
        "200":
          description: OK
          schema:
            $ref: "#/definitions/password_response"
          examples:
            Error 1001 - TipoId o Id de usuario inexistente:
              result:
                status: false
                http_code: 200
                info: TipoId / Id de usuario inexistente
                request_id: 123456abcde
                errors:
                  - code: 1001
                    message: Tipo de identificador de usuario incorrecto
            Error 1002 - credenciales incorrectas:
              result:
                status: false
                http_code: 200
                info: Credenciales incorrectas
                request_id: 123456abcde
                errors:
                  - code: 1002
                    message: credenciales incorrectas
            Error 1003 - Password debe contener mayúsculas:
              result:
                status: false
                http_code: 200
                info: Nueva password no cumple los requisitos
                request_id: 123456abcde
                errors:
                  - code: 1003
                    message: la password debe contener al menos una mayúscula
            Error 1003 - Password debe contener números:
              result:
                status: false
                http_code: 200
                info: Nueva password no cumple los requisitos
                request_id: 123456abcde
                errors:
                  - code: 1003
                    message: la password debe contener al menos una número
        "400":
          description: Bad request
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 400
                info: Parámetros incorrectos.
                request_id: 123456abcde
                errors:
                  - code: 1001
                    message: Login incorrecto
        "401":
          description: Unauthorized
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 401
                info: No autorizado
                request_id: 123456abcde
                errors:
                  - code: 1002
                    message: Credenciales erronéas
        "403":
          description: Forbidden
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 403
                info: Recurso prohibido
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: El usuario no tiene permisos para realizar la acción solicitada
        "404":
          description: Not Found
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 404
                info: No encontrado
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: Usuario no encontrado
        "429":
          description: Too many requests
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 429
                info: Cuota de peticiones excedida
                request_id: 123456abcde
                errors:
                  - code: 1009
                    message: Se ha superado el número máximo de peticiones.
        default:
          description: Default error response
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 500
                info: Error desconocido
                request_id: 123456abcde
                errors:
                  - code: 0
                    message: Mensaje de error
      x-auth-type: Application User
      x-throttling-tier: Unlimited
      x-scope: USUG-api_user-scope
  /usuarios/estado:
    put:
      summary: Bloqueo de un usuario
      description: "Bloquea a un usuario en todos los sistemas de autenticación en los que esté este usuario\nLa identificación de usuario se aporta en el **body** de la petición. \n### Códigos de error del método:\n* 1001 - login incorrecto\n"
      tags:
        - modificación
      parameters:
        - in: body
          name: request_body
          schema:
            $ref: "#/definitions/identificacion_usuario"
          required: true
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/usuarios_login_estado_response"
          examples:
            application/json:
              result:
                status: true
                http_code: 200
                request_id: 12345abcde
                num_elements: 1
              data:
                correcto: false
                baja: false
                fecha_acceso_valida: true
                password_caducada: false
                tiene_preg_seguridad: true
                bloqueado: true
                tipo_bloqueo: B
            Error 1001 - TipoId o Id de usuario inexistente:
              result:
                status: false
                http_code: 200
                info: TipoId / Id de usuario inexistente
                request_id: 123456abcde
                errors:
                  - code: 1001
                    message: Tipo de identificador de usuario incorrecto
        "400":
          description: Bad request
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 400
                info: Parámetros incorrectos.
                request_id: 123456abcde
                errors:
                  - code: 1001
                    message: Login incorrecto
        "401":
          description: Unauthorized
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 401
                info: No autorizado
                request_id: 123456abcde
                errors:
                  - code: 1002
                    message: Credenciales erronéas
        "403":
          description: Forbidden
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 403
                info: Recurso prohibido
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: El usuario no tiene permisos para realizar la acción solicitada
        "404":
          description: Not Found
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 404
                info: No encontrado
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: Usuario no encontrado
        "429":
          description: Too many requests
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 429
                info: Cuota de peticiones excedida
                request_id: 123456abcde
                errors:
                  - code: 1009
                    message: Se ha superado el número máximo de peticiones.
        default:
          description: Default error response
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 500
                info: Error desconocido
                request_id: 123456abcde
                errors:
                  - code: 0
                    message: Mensaje de error
      x-auth-type: Application User
      x-throttling-tier: Unlimited
      x-scope: USUG-api_manager-scope
  /accesos:
    post:
      summary: Registra el acceso correcto o incorrecto de un usuario en una aplicación
      description: registra acceso
      tags:
        - modificación
      parameters:
        - in: body
          name: request_body
          schema:
            $ref: "#/definitions/accesos_body_parameters"
          required: true
      responses:
        "201":
          description: Success
          schema:
            $ref: "#/definitions/accesos_response"
          examples:
            acceso registrado correctamente:
              result:
                status: true
                http_code: 200
                request_id: 12345abcde
                num_elements: 1
              data:
                id_acceso: 12232
        "400":
          description: Bad request
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 400
                info: Parámetros incorrectos.
                request_id: 123456abcde
                errors:
                  - code: 1001
                    message: Login incorrecto
        "401":
          description: Unauthorized
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 401
                info: No autorizado
                request_id: 123456abcde
                errors:
                  - code: 1002
                    message: Credenciales erronéas
        "403":
          description: Forbidden
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 403
                info: Recurso prohibido
                request_id: 123456abcde
                errors:
                  - code: 1004
                    message: El usuario no tiene permisos para realizar la acción solicitada
        "429":
          description: Too many requests
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 429
                info: Cuota de peticiones excedida
                request_id: 123456abcde
                errors:
                  - code: 1009
                    message: Se ha superado el número máximo de peticiones.
        default:
          description: Default error response
          schema:
            $ref: "#/definitions/standard_response_result"
          examples:
            application/json:
              result:
                status: false
                http_code: 500
                info: Error desconocido
                request_id: 123456abcde
                errors:
                  - code: 0
                    message: Mensaje de error
      x-auth-type: Application User
      x-throttling-tier: Unlimited
      x-scope: USUG-api_user-scope
definitions:
  standard_response_result:
    properties:
      result:
        type: object
        properties:
          status:
            type: boolean
            description: Resultado de éxito o error de la operación
          http_code:
            type: integer
            description: Código http de la respuesta.
            example: 200
          errors:
            type: array
            description: "Array de errores. Opcional. Se usará cuando se haya producido al menos un error, pudiéndose especificar tódos los que se hayan producido."
            items:
              $ref: "#/definitions/standard_error"
          info:
            type: string
            description: Breve mensaje indicando si la operación fue exitosa o no.
            example: Solicitud realizada con éxito.
          stack_trace:
            type: string
            description: Traza de error en caso de que lo haya para facilitar la depuración. Solo se incluirá en el entorno de desarrollo.
            example: Java.Lang.NullPointerException at ...
          request_id:
            type: string
            description: Identificador de la petición en el sistema de logging para facilitar la depuración de errores. Contenido de la cabecera x-trace-id.
            example: null
          num_elements:
            type: integer
            description: Número de elementos borrados o modificados cuando se reciben llamadas con métodos PUT o DELETE sobre varios recursos. Obligatorio para borrados lógicos.
            example: 0
        required:
          - status
          - http_code
          - request_id
  standard_response_result_metadata:
    allOf:
      - $ref: "#/definitions/standard_response_result"
    properties:
      metadata:
        allOf:
          - $ref: "#/definitions/standard_paging"
  standard_paging_link:
    type: object
    properties:
      href:
        type: string
        description: Enlace codificado en html.
  standard_error:
    type: object
    properties:
      code:
        type: integer
        description: Codigo de error devuelto por la API. Se especificarán códigos de errores controlados. En el caso de errores no controlados se especificará si es posible. De lo contrario se deberá indicar un código 500.
      message:
        type: string
        description: Descripción textual del error devuelto
  standard_paging:
    type: object
    description: "Objeto a devolver en caso de que se devuelva una respuesta paginada. Los datos irán en el campo 'data', la información sobre paginación se incluirá en este objeto."
    properties:
      init:
        type: integer
        description: Índice del primer registro.
        example: 0
      limit:
        type: integer
        description: Índice del último registro.
        example: 34
      total:
        type: integer
        description: Número total de registros.
        example: 35
      init_page:
        type: integer
        description: Página actual o registro inicial de la página.
        example: 2
      num_pages:
        type: integer
        description: Número total de páginas.
        example: 7
      total_pages:
        type: integer
        description: Número total de paginas.
        example: 7
      links:
        type: object
        properties:
          self:
            description: Enlace a la propia página devuelta.
            allOf:
              - $ref: "#/definitions/standard_paging_link"
          first:
            description: Enlace a la primera página.
            allOf:
              - $ref: "#/definitions/standard_paging_link"
          previous:
            description: Enlace a la página previa
            allOf:
              - $ref: "#/definitions/standard_paging_link"
          next:
            description: Enlace a la página siguiente.
            allOf:
              - $ref: "#/definitions/standard_paging_link"
          last:
            description: Enlace a la última página.
            allOf:
              - $ref: "#/definitions/standard_paging_link"
    required:
      - init
      - limit
  standard_parameters_examples:
    type: object
    properties:
      integer_data:
        type: integer
        description: datos de tipo entero de 0 a 100 multiplos de 5
        minimum: 0
        maximum: 100
        multipleOf: 5
        example: 15
      number_data:
        type: number
        description: parámetros de tipo number
        minimum: 0.1
        maximum: 99.9
        example: 7.5
      date_data:
        type: string
        format: date
        description: datos de tipo fecha ISO 8061 - yyyy-MM-dd
        example: "2019-02-25"
      date_time_data:
        type: string
        format: date-time
        description: "datos de tipo fecha y hora ISO 8061 - yyyy-MM-ddThh:mm:ssZ+hh:00"
        example: "2019-01-25T23:55:33+01:00"
      string_data:
        type: string
        description: datos de tipo texto de 3 a 50 posiciones con un pattern
        example: Ejemplo datos de tipo texto
        minLength: 3
        maxLength: 50
        pattern: "^\\d{3}-\\d{2}-\\d{4}$"
      read_only_data:
        type: string
        description: datos de tipo texto de solo lectura
        example: Ejemplo datos de tipo texto de solo lectura
        readOnly: true
      boolean_data:
        type: boolean
        description: datos de tipo boolean
        example: true
      array_data:
        type: array
        minItems: 1
        maxItems: 500
        uniqueItems: true
        items:
          type: object
          properties:
            property_1:
              type: string
              example: ejemplo de property 1
            property_2:
              type: string
              example: ejemplo de property 2
            property_n:
              type: string
              example: ejemplo de property n
          description: datos del mismo tipo dentro de un array. Puede ser cualquiera de los tipos primitivos u otro objeto
        example:
          - property_1: property_1 de elemento 1
            property_2: property_2 de elemento 1
            property_n: property_n de elemento 1
          - property_1: property_1 de elemento 2
            property_2: property_2 de elemento 2
            property_n: property_n de elemento 2
      enum_data:
        type: string
        enum:
          - S
          - C
          - D
        example: S
        description: "estado civil:\n  * S - Soltero\n  * C - Casado\n  * D - Divorciado\n"
    required:
      - integer_data
      - string_data
  identificacion_usuario:
    type: object
    properties:
      almacen_usuarios:
        allOf:
          - $ref: "#/definitions/codigo_almacen_usuarios"
      tipo_identificador:
        type: string
        enum:
          - LOGIN
          - DNI
        example: LOGIN
        description: "Tipos de identificador de usuario:\n  * LOGIN - Login del usuario en el almacen de usuarios concreto\n  * DNI - DNI o NIE del usuario\n"
      id:
        type: string
        description: identificador del usuario. Será un DNI o LOGIN según el campo tipo_identificador
        example: JRP123
    required:
      - almacen_usuarios
      - tipo_identificador
      - id
  identificacion_usuario_aplicacion:
    allOf:
      - $ref: "#/definitions/identificacion_usuario"
    properties:
      aplicacion:
        type: string
        description: nombre de la aplicacion de la que se quiere obtener los perfiles. Si se deja en blanco se obtendrán los perfiles de todas las aplicaciones del usuario
        example: reee_presenta
  codigo_almacen_usuarios:
    type: string
    maxLength: 20
    enum:
      - USUG_DA
      - USUG_LDAP
      - USUI
      - USUT
      - USUJ
    example: USUG_DA
    description: "Almacen de usuarios en los que puede estar una aplicación:\n  * USUG_DA - Autentica en DA y autoriza en USUG\n  * USUG_LDAP - Autentica en LDAP y autoriza en USUG\n  * USUI - Autentica y autoriza en USUI\n  * USUT - Autentica y autoriza en USUT\n  * USUJ - Autentica y autoriza en USUJ\n \n"
  usuario:
    type: object
    properties:
      login_usuario:
        type: string
      dni:
        type: string
      email:
        type: string
      nombre:
        type: string
      apellido1:
        type: string
      apellido2:
        type: string
      direccion:
        type: string
      telefono:
        type: string
      organismo:
        type: string
      dependencia:
        type: string
      puesto_de_trabajo:
        type: string
  usuario_perfil:
    allOf:
      - $ref: "#/definitions/usuario"
    properties:
      perfiles:
        type: array
        items:
          allOf:
            - $ref: "#/definitions/perfil"
  estado_usuario:
    type: object
    properties:
      correcto:
        type: boolean
        description: Indica si el usuario puede acceder a los sistemas de informacion
        example: true
      baja:
        type: boolean
        description: Indica si este usuario ha sido dado de baja en el sistema
        example: true
      fecha_acceso_valida:
        type: boolean
        description: Indica si este usuario ha llegado a la fecha de expiración o todavía no puede acceder al sisetma
        example: true
      fecha_renovacion_password:
        type: string
        format: date
        description: datos de tipo fecha ISO 8061 - yyyy-MM-dd
        example: "2019-02-25"
      password_caducada:
        type: boolean
        description: Indica si este usuario tiene la password caducada
        example: true
      tiene_preg_seguridad:
        type: boolean
        description: Indica si este usuario tiene pregunta de seguridad
        example: true
      bloqueado:
        type: boolean
        description: Indica si este usuario está bloqueado y no puede entrar
        example: true
      tipo_bloqueo:
        type: string
        enum:
          - B
          - V
          - I
          - S
        description: "Causa por la que el usuario está bloqueado (puede ser vacio):\n  * B - Bloqueado Manualmente\n  * V - Bloqueado por intentos erroneos de acceso\n  * I - Bloqueado por inactividad\n  * S - Dado de baja     \n"
    required:
      - correcto
      - fecha_acceso_valida
      - baja
      - password_caducada
      - tiene_preg_seguridad
      - bloqueado
  token:
    type: object
    properties:
      contenido:
        type: string
        description: contenido del token
        example: 0b71ce04-2439-49e8-8de0-2cda7937507
      fecha_validez:
        type: string
        description: fecha máxima de validez del token en ISO 8601 (completa)
        example: "2019-05-03T21:35:55+02:00"
  perfil:
    type: object
    properties:
      aplicacion:
        type: string
        example: reee_presenta
      id_perfil:
        type: string
        example: 1
      descripcion:
        type: string
        example: Perfil de consulta
  aplicacion:
    type: object
    properties:
      codigo_aplicacion:
        type: string
        example: reee_presenta
      description:
        type: string
        example: registro de edificios de eficiencia energetica
      almacen_usuarios:
        allOf:
          - $ref: "#/definitions/codigo_almacen_usuarios"
      perfiles:
        type: array
        items:
          allOf:
            - $ref: "#/definitions/perfil"
  usuarios_login_estado_response:
    allOf:
      - $ref: "#/definitions/standard_response_result"
    properties:
      data:
        allOf:
          - $ref: "#/definitions/estado_usuario"
  token_body_parameters:
    type: object
    properties:
      login:
        type: string
        example: ADMON
      password:
        type: string
        example: ADMON
      sistema_autenticacion:
        type: string
        example: IntranetDA
      modulo_tecnico:
        type: string
        example: EJPL_XXXREST136
      token_un_uso:
        type: string
        example: "N"
      minutos_tiempo_validez:
        type: integer
        example: 11444
      informacion_adicional:
        type: string
        example: Acceso al puesto
  token_response:
    allOf:
      - $ref: "#/definitions/standard_response_result"
    properties:
      data:
        properties:
          token:
            allOf:
              - $ref: "#/definitions/token"
          estado_usuario:
            allOf:
              - $ref: "#/definitions/estado_usuario"
  perfiles_response:
    allOf:
      - $ref: "#/definitions/standard_response_result"
    properties:
      data:
        properties:
          perfiles:
            type: array
            items:
              allOf:
                - $ref: "#/definitions/perfil"
  password_body_parameters:
    type: object
    properties:
      almacen_usuarios:
        allOf:
          - $ref: "#/definitions/codigo_almacen_usuarios"
      login:
        type: string
        description: Login del usuario
        example: jlc543
      old_password:
        type: string
        minLength: 8
        maxLength: 16
        example: AFDSFASDF
      new_password:
        type: string
        minLength: 8
        maxLength: 16
        example: DSAFASDF
      new_preg_seguridad:
        type: string
        maxLength: 50
        example: COMO SE LLAMA MI PERRO
      new_resp_seguridad:
        type: string
        maxLength: 64
        example: TOBI
    required:
      - login
      - almacen_usuarios
      - old_password
      - new_password
  password_response:
    allOf:
      - $ref: "#/definitions/standard_response_result"
    properties:
      data:
        type: object
        properties:
          id_solicitud:
            type: integer
            description: id de la solicitud de cambio de contraseña
            example: 835463762
  accesos_body_parameters:
    type: object
    properties:
      data:
        type: object
        properties:
          aplicacion:
            type: string
          usuario:
            type: string
          acceso_correcto:
            type: boolean
          error_credenciales:
            type: boolean
            description: cuando el acceso no es correcto indica si el error ha sido por credenciales o por error de plataforma
          acceso_directo_sso:
            type: string
            description: enumerado SSO / DIRECTO
          almacen_usuarios:
            allOf:
              - $ref: "#/definitions/codigo_almacen_usuarios"
          modo_acceso:
            type: string
            description: "politicaIntranet, DameToken, IdentityServer"
          modo_acceso_detalle:
            type: string
            description: mecanismo usuario y contraseña / certificado
  accesos_response:
    allOf:
      - $ref: "#/definitions/standard_response_result"
    properties:
      data:
        type: object
        properties:
          id:
            type: string
            description: identificador del registro de acceso dado de alta
            example: 11122
  usuarios_aplicaciones_body_parameters:
    type: object
    properties:
      login:
        type: string
        example: ADMON
      almacen_usuarios:
        allOf:
          - $ref: "#/definitions/codigo_almacen_usuarios"
  usuarios_aplicaciones_response:
    allOf:
      - $ref: "#/definitions/standard_response_result"
    properties:
      data:
        type: object
        properties:
          aplicaciones:
            type: array
            items:
              allOf:
                - $ref: "#/definitions/aplicacion"
  aplicaciones_usuarios_body_parameters:
    properties:
      cod_aplicacion:
        type: string
        description: codigo de la aplicación (si no se informa buscará de todas las aplicaciones)
        example: reee_presenta
  aplicaciones_usuarios_response:
    allOf:
      - $ref: "#/definitions/standard_response_result_metadata"
    properties:
      data:
        type: object
        properties:
          usuarios:
            type: array
            items:
              type: object
              properties:
                usuario:
                  allOf:
                    - $ref: "#/definitions/usuario_perfil"
                ultimo_acceso:
                  type: string
                  description: ultimo acceso del usuario en la aplicación
x-wso2-security:
  apim:
    x-wso2-scopes:
      - name: USUG-api_manager-scope
        description: Scope para usuario gestor con permisos para bloquear a otros usuarios
        key: USUG-api_manager-scope
        roles: USUG_1
      - name: USUG-api_user-scope
        description: Scope para usuario general
        key: USUG-api_user-scope
        roles: "USUG_1,USUG_2"
